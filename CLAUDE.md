# CLAUDE.md

## 核心原则（YOU MUST / IMPORTANT 强制遵守）
- YOU MUST 任务前优先检查 `.claude/skills/` 并使用匹配技能
- YOU MUST 所有结论基于文件读取/命令执行/官方文档/社区最佳实践的验证结果，用`Read`/`Grep`/`Glob`/`WebSearch`等工具获取事实，绝对禁止猜测，必须先验证准确性后再给结果
- 使用中文
- YOU MUST 有任何疑问，随时调用 `AskUserQuestion` 工具向我询问
- 判断是否使用 `context7` MCP 获取最新事实

---

## 关键规则

### 1. 代码组织

* 多个小文件优于少量大文件
* 高内聚，低耦合
* 每个文件典型 200-400 行，最多 800 行
* 按功能/领域组织，而非按类型

### 2. 代码风格

* 代码、注释或文档中不使用表情符号
* 始终使用不可变性 - 永不改变对象或数组
* 生产代码中不使用 console.log
* 使用 try/catch 进行适当的错误处理
* 使用 Zod 或类似工具进行输入验证

### 3. 测试

* TDD：先写测试
* 最低 80% 覆盖率
* 工具函数进行单元测试
* API 进行集成测试
* 关键流程进行端到端测试

### 4. 安全

* 不硬编码密钥
* 敏感数据使用环境变量
* 验证所有用户输入
* 仅使用参数化查询
* 启用 CSRF 保护

---

## 任务执行流程
### 1. 难度判断与策略
- 简单任务（单文件修改/Bug修复/小型功能）：YOU MUST 使用 Agent 并行子代理执行以提高效率
- 复杂任务（跨模块/架构调整/新特性开发）：YOU MUST 先计划再执行

### 2. 复杂任务 Agent 团队编排
YOU MUST 至少组建10个 Agent 成员，并且必须为它们选择合适的 SKILL 技能，包括但不限于：
- Lead：协调任务、管理所有 Agent，不直接参与写代码
- 架构师：设计整体方案、拆解步骤、评估风险
- 开发工程师：负责编码，YOU MUST 调用 `tdd-workflow` SKILL
- 测试工程师：编写测试，YOU MUST 确保覆盖率 ≥ 80%
- 安全审查员：进行安全 Code Review
- 性能审查员：进行性能 Code Review

---

## 执行前检查清单（YOU MUST 逐项确认）
- [ ] 语言：中文
- [ ] 难度：（简单/复杂）
- [ ] 策略：（简单任务用并行子代理；复杂任务先计划再执行）
- [ ] SKILL 技能：每次执行必须匹配合适的 SKILL 技能
- [ ] Agent 编排：复杂任务需 Agent 团队角色编排和各自不同的 SKILL 技能（简单任务无需）
- [ ] 流程：（TDD/无需流程）
- [ ] 验证：所有结论均已验证，绝对禁止推测
- [ ] 规划：复杂任务已先计划再执行（简单任务无需）
- [ ] Context7：（已使用/无需使用）
- [ ] 自查：清单完整则执行，否则说明上下文已撑爆，YOU MUST 先执行 `/compact` 压缩再继续